<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Jogo da Velha</title>

<style>
    body {
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: #111;
        font-family: Arial, sans-serif;
        color: white;
        text-align: center;
    }
    #status {
        margin-top: 10px;
        font-size: 1.2em;
        font-weight: bold;
    }
</style>
</head>

<body>
<div>
    <canvas id="game"></canvas>
    <div id="status">Seu turno. Você é O</div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let size = Math.min(window.innerWidth * 0.9, 400);
canvas.width = size;
canvas.height = size;

let board = [
    ["", "", ""],
    ["", "", ""],
    ["", "", ""]
];

let currentPlayer = "O"; // jogador humano = O
let winner = null;
let draw = false;
let winningLine = null; // marcação da vitória

const statusText = document.getElementById("status");

// ================== DESENHO DO JOGO =====================

function drawBoard() {
    ctx.clearRect(0, 0, size, size);
    ctx.strokeStyle = "white";
    ctx.lineWidth = 3;

    const cell = size / 3;

    for (let i = 1; i < 3; i++) {
        ctx.beginPath();
        ctx.moveTo(i * cell, 0);
        ctx.lineTo(i * cell, size);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(0, i * cell);
        ctx.lineTo(size, i * cell);
        ctx.stroke();
    }
}

function drawPieces() {
    const cell = size / 3;
    ctx.lineWidth = 6;

    for (let r = 0; r < 3; r++) {
        for (let c = 0; c < 3; c++) {
            const x = c * cell + cell / 2;
            const y = r * cell + cell / 2;

            if (board[r][c] === "O") {
                ctx.strokeStyle = "cyan";
                ctx.beginPath();
                ctx.arc(x, y, cell / 3, 0, Math.PI * 2);
                ctx.stroke();
            } else if (board[r][c] === "X") {
                ctx.strokeStyle = "orange";
                ctx.beginPath();
                ctx.moveTo(x - cell/3, y - cell/3);
                ctx.lineTo(x + cell/3, y + cell/3);
                ctx.moveTo(x + cell/3, y - cell/3);
                ctx.lineTo(x - cell/3, y + cell/3);
                ctx.stroke();
            }
        }
    }
}

function drawWinningLine() {
    if (!winningLine) return;
    ctx.strokeStyle = "red";
    ctx.lineWidth = 6;
    ctx.beginPath();
    ctx.moveTo(winningLine.x1, winningLine.y1);
    ctx.lineTo(winningLine.x2, winningLine.y2);
    ctx.stroke();
}

// ================== LÓGICA DO JOGO =====================

function checkWin() {
    const wins = [
        [[0,0],[0,1],[0,2]],
        [[1,0],[1,1],[1,2]],
        [[2,0],[2,1],[2,2]],
        [[0,0],[1,0],[2,0]],
        [[0,1],[1,1],[2,1]],
        [[0,2],[1,2],[2,2]],
        [[0,0],[1,1],[2,2]],
        [[0,2],[1,1],[2,0]]
    ];

    for (const combo of wins) {
        const [a, b, c] = combo;
        if (board[a[0]][a[1]] &&
            board[a[0]][a[1]] === board[b[0]][b[1]] &&
            board[a[0]][a[1]] === board[c[0]][c[1]]) {

            winner = board[a[0]][a[1]];

            winningLine = {
                x1: (a[1] + .5) * (size/3),
                y1: (a[0] + .5) * (size/3),
                x2: (c[1] + .5) * (size/3),
                y2: (c[0] + .5) * (size/3)
            };

            return true;
        }
    }

    if (board.flat().every(cell => cell)) {
        draw = true;
    }

    return false;
}

function botMove() {
    if (winner || draw) return;
    
    while (true) {
        const r = Math.floor(Math.random() * 3);
        const c = Math.floor(Math.random() * 3);
        if (!board[r][c]) {
            board[r][c] = "X";
            break;
        }
    }

    currentPlayer = "O";
    updateGame();
}

function updateGame() {
    drawBoard();
    drawPieces();
    checkWin();
    drawWinningLine();

    if (winner) {
        statusText.textContent = winner === "O" ? "Você venceu!" : "O computador venceu!";
        setTimeout(resetGame, 2500);
    } else if (draw) {
        statusText.textContent = "Empate!";
        setTimeout(resetGame, 2000);
    } else {
        statusText.textContent = currentPlayer === "O" ? "Seu turno. Você é O" : "O computador está jogando...";
    }
}

// ================== INPUT =====================

function play(e) {
    if (winner || draw) return;

    const rect = canvas.getBoundingClientRect();
    const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
    const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;

    const cell = size / 3;
    const c = Math.floor(x / cell);
    const r = Math.floor(y / cell);

    if (board[r][c] || currentPlayer !== "O") return;
    
    board[r][c] = "O";
    currentPlayer = "X";
    updateGame();

    if (!winner && !draw) {
        setTimeout(botMove, 400);
    }
}

canvas.addEventListener("click", play);
canvas.addEventListener("touchstart", play);

// ================== RESET =====================

function resetGame() {
    board = [["","",""],["","",""],["","",""]];
    currentPlayer = "O";
    winner = null;
    draw = false;
    winningLine = null;
    updateGame();
}

updateGame();
</script>
</body>
</html>